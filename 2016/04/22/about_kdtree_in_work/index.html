<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="author" content="Benny Chin">
<meta name="description" content="Mini-Lab for GeoGraphical data analysis">
<meta name="generator" content="mynt v0.3.1">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
	<link href='//fonts.googleapis.com/earlyaccess/cwtexyen.css' rel='stylesheet' type='text/css'>
	<link href='//fonts.googleapis.com/css?family=Gruppo' rel='stylesheet' type='text/css'>
	<!--<link href='http://fonts.googleapis.com/earlyaccess/cwtexhei.css' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Noto+Sans' rel='stylesheet' type='text/css'>-->
  <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Ubuntu:400,700,400italic,700italic|Ubuntu+Mono:400,700,400italic,700italic" type="text/css">-->
  
  <!-- flex list for navbar
  –––––––––––––––––––––––––––––––––––––––––––––––––– 
<link href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" rel="stylesheet"/>-->

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– 
<link rel="alternate" href="/feed.xml" type="application/atom+xml">-->
  
  <link rel="stylesheet" href="/assets/css/normalize.css" type="text/css">
  <link rel="stylesheet" href="/assets/css/skeleton.css" type="text/css">
  <link rel="stylesheet" href="/assets/css/pastie.css" type="text/css">
  <link rel="stylesheet" href="/assets/css/typicons/typicons.css" type="text/css">
<link rel="stylesheet" href="/assets/css/pygments.css" type="text/css">

<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<script src="/assets/js/mynt.min.js" type="text/javascript"></script>-->


  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– 
  <link rel="icon" type="image/png" href="images/favicon.png">-->
<link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
<!--
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Droid Sans', 'Droid Serif']
    }
  });
</script>
-->

  <!-- Google analytics
  ––––––––––––––––––––––––––––––––––––––––––––––––––  -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65836543-1', 'auto');
  ga('send', 'pageview');

</script>

  <!-- MathJax
  ––––––––––––––––––––––––––––––––––––––––––––––––––  -->
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
    
    <title>the nearest neighbours in two dimensions space : Blog – Chin.Mini-Lab</title>

	
	<!--<link rel="stylesheet" href="//cdn.muut.com/1/moot.css">-->

</head>

<body>
  <div class="container">
	<div class="row">
	<div class="five columns" style="margin-top: 1%">
		<h2 id="title"><font face="Gruppo">Chin.Mini-Lab<a href="/" title="Chin.Mini-Lab"><big><span class="typcn typcn-globe-outline"></span></big></a>
        <small>Geo-Graph-ing</small></font></h2>
        
    </div>
	  <div class="seven columns" style="margin-top: 1%">
			<div align="right"> 
			<font face="Gruppo"><h2>
			<a href="/" title="Blog"><span class="typcn typcn-home"></span> <small>Blog</small> </a> | 
			<a href="/about/" title="About"><span class="typcn typcn-user"></span> <small>Me</small> </a> | 
			<a href="/publications/" title="Publications"><span class="typcn typcn-zoom"></span> <small>Writes</small> </a> |
			<a href="/presentations/" title="Presentations"><span class="typcn typcn-image"></span> <small>Meets</small> </a> |
            <a href="/projects/" title="Projects"><span class="typcn typcn-code"></span> <small>Codes</small> </a> |
			<a href="/working/" title="Working"><span class="typcn typcn-device-laptop"></span> <small>Works</small> </a> <!--| 
			<a href="/geograph/" title="Geo-Graph"><span class="typcn typcn-flow-switch"></span></a> | 
			<a href="/lightbulb/" title="Light-bulb"><span class="typcn typcn-lightbulb"></span></a> | 
			<a href="/notes/" title="Notes"><span class="typcn typcn-edit"></span></a> |  
			<a href="/links/" title="Links"><span class="typcn typcn-link-outline"></span></a>-->
			</h2></font>
			</div>
      </div>
	</div>
	<div class="row">
        <font face="Gruppo">
    <span class="typcn typcn-globe"></span><a href="/">Mini-lab</a> / the nearest neighbours in two dimensions space
</font>
	</div>
    <div class="row">
		<div class="eight columns">
			<div id="content">
				<div class="container">
					
<h2 class="post-title"> the nearest neighbours in two dimensions space </h2>

				</div>
			</div>
		</div>
		<div class="four columns">
			<div id="content">
				<div class="container">
					<font face="Gruppo">
<h5 class="post-meta" align="right">Friday, April 22, 2016 <span>»</span> <a href="/tags/python/">python</a></h5>
</font>
				</div>
			</div>
		</div>
			<hr width="80%">
    </div>
    <div class="row">
		<div id="content">
			<div class="container">
				
    <h2>nearest neighbours</h2>
<p>Which points are the nearest neighbours, or top N nearest neighbours, are the frequently used procedures in point data analysis. 
Sometimes, we might need to find the neighbours in-radius of some distance. </p>

<p>K-d tree is one of the data structure for searching the points that is closer to a target point that is in k-dimensions. 
E.g. for 2-d points, each point has a x coordinate and a y coordinate, it is called 2-d tree. 
In a 2-d tree, starting from the root, is the first dimension (let say x-dimension), then the second level would be for the second dimension (y-dimension).
The idea is to divide the points into two groups in each level, smaller item go to the left, bigger item go to the right&hellip;</p>

<p>So, the kd-tree helps to reduce the k-dimension nearest neighbours problem into a simpler problem (in terms of complexity), by using the divide-and-conquer trick.</p>
<h2>working in python</h2>
<p>In this example, base points are the points in the ground, let says, the shops;
source points are the points that is going to search for the nearest destinations (base points), let says, the location of the people. 
The aim is to locate the shops that is nearby to each person. 
So, it would be for each person, search one time.</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>

<span class="n">xlist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="c"># x coordinates of base points...</span>
<span class="n">ylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="c"># y coordinates of base points...</span>

<span class="n">px</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">]</span> <span class="c"># x coordinates for the three people</span>
<span class="n">py</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">,</span> <span class="mf">9.8</span><span class="p">]</span> <span class="c"># y coordinates for the three people</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xlist</span><span class="p">,</span><span class="n">ylist</span><span class="p">)</span>
<span class="n">pts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">py</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">nn_radius</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># the nearby radius for searching</span>
<span class="n">nlist</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">nn_radius</span><span class="p">)</span> 
<span class="c"># If x is a single point, returns a list of the indices of the neighbors of x. </span>
<span class="c"># If x is an array of points, returns an object array of shape tuple containing lists of neighbors.</span>
<span class="c"># in this case, it will return an array of list, which represent the index of the nearby neighbours in the data list. </span>
</pre></div>
</td></tr></table></div></div>
<p>besides query_ball_point, there are other methods (from <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.KDTree.html#scipy.spatial.KDTree">scipy</a>):</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">count_neighbors</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">r</span><span class="p">[,</span> <span class="n">p</span><span class="p">])</span>  <span class="c">#Count how many nearby pairs can be formed.</span>
<span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">[,</span> <span class="n">k</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">distance_upper_bound</span><span class="p">])</span> <span class="c">#Query the kd-tree for nearest neighbors</span>
<span class="n">query_ball_tree</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">r</span><span class="p">[,</span> <span class="n">p</span><span class="p">,</span> <span class="n">eps</span><span class="p">])</span> <span class="c">#Find all pairs of points whose distance is at most r</span>
<span class="n">query_pairs</span><span class="p">(</span><span class="n">r</span><span class="p">[,</span> <span class="n">p</span><span class="p">,</span> <span class="n">eps</span><span class="p">])</span>    <span class="c">#Find all pairs of points within a distance.</span>
<span class="n">sparse_distance_matrix</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">max_distance</span><span class="p">)</span> <span class="c">#Compute a sparse distance matrix</span>
</pre></div>
</td></tr></table></div></div>
<p><a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.KDTree.html#scipy.spatial.KDTree">more details from scipy docs</a></p>

    <!--
	<a class="muut" href="https://muut.com/i/wcchin/comments" type="dynamic">wcchin forum</a>
	<script src="//cdn.muut.com/1/moot.min.js"></script>-->
	<div id="disqus_thread"></div>
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES * * */
		var disqus_shortname = 'chinminilab';
		
		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES * * */
		var disqus_shortname = 'chinminilab';
		
		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function () {
			var s = document.createElement('script'); s.async = true;
			s.type = 'text/javascript';
			s.src = '//' + disqus_shortname + '.disqus.com/count.js';
			(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
		}());
	</script>

			</div>
		</div>
	</div>
    <div class="row">
			<hr width="80%">
		<div id="content">
			<div class="container" align="center">
				 <h6><font face="Gruppo"> <small>Built with <a href="http://mynt.uhnomoli.com" target="blank">mynt</a>.<br></small> 2015 <a href="/" title="Chin.Mini-Lab"><span class="typcn typcn-globe"></span></a> Benny Chin.</font></h6>
			</div>
		</div>
	</div>
    </div>
  </div>
</body>
</html>
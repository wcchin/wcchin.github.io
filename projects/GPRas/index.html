<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Chin.Mini-Lab – Geo-Graph-ing</title>

    <link rel="stylesheet" href="/assets/css/minimal_orderedlist.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/typicons/typicons.css" type="text/css">
    <!--<link rel="stylesheet" href="/assets/css/pygment_trac.css" type="text/css">-->
    <link rel="stylesheet" href="/assets/css/pygments.css" type="text/css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <p><a href="/projects/" title="Projects"><span class="typcn typcn-code"></span> Codes </a> <a href="/" title="Home"><span class="typcn typcn-globe-outline"></span> Home </a></p>
        <h1 class="post-title">  Geographical PageRank Algorithms </h1>
        <p> <small>Tags: </small><br><span>»</span> <a href="/projects/tag/GPR/">GPR</a><br><span>»</span> <a href="/projects/tag/network/">network</a><br><span>»</span> <a href="/projects/tag/PR/">PR</a><br><span>»</span> <a href="/projects/tag/spatial/">spatial</a></p>

        <p class="view">
            <a href="https://bitbucket.org/wcchin/gpras">View the Project <small> GPRas </small></a></p>
        <ul>
          <li><a href="https://bitbucket.org/wcchin/gpras/get/d00c8227d48f.zip">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://pypi.python.org/pypi/GPRas">Visit at <strong> pypi </strong></a></li>
          <li><a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0139509">Read the  <strong>Article</strong></a></li>
      </ul>
      </header>
      <section>
          <span class="typcn typcn-globe"></span><a href="/">Mini-lab</a> / <a href="/projects/">Projects</a> /  Geographical PageRank Algorithms
          <br>
         <h1>Algorithms for measuring concentration distribution in a spatial network.</h1>
         <p>GPRas</p>
<h3>published article and applications</h3>
<p><a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0139509" target="blank">Chin, W. C. B., &amp; Wen, T. H. (2015). Geographically Modified PageRank Algorithms: Identifying the Spatial Concentration of Human Movement in a Geospatial Network. PLoS ONE 10(10): e0139509. DOI:10.1371/journal.pone.0139509.</a></p>
<h2>Intro.</h2>
<p>The algorithm can be used to calculate these from a spatial network, i.e. network with x, y coordinates that can be used to calculate distance (i.e. projected accordingly from longitude and latitude):</p>

<ul>
<li>PR</li>
<li>WPR</li>
<li>DDPR (proposed in the PloSOne article above)</li>
<li>GPR (proposed in the PloSOne article above)</li>
<li>eDDPR (proposed in the PloSOne article above)</li>
<li>eGPR (proposed in the PloSOne article above)</li>
</ul>
<h1></h1><h2>dependencies</h2>
<ul>
<li>numpy</li>
<li>pandas</li>
<li>geopandas</li>
<li>shapely</li>
<li>networkx</li>
</ul>
<h1></h1><h2>installing GPRas</h2>
<p>on windows:</p>

<p>install shapely first. can use conda if you are using anaconda(miniconda).</p>
<pre><code>conda install -c scitools shapely=1.5.13
</code></pre>
<p>Geopandas is needed to be installed before installing this, which could be hard to install.
First download these from here: <a href="http://www.lfd.uci.edu/%7Egohlke/pythonlibs/">http://www.lfd.uci.edu/~gohlke/pythonlibs/</a></p>

<ul>
<li>GDAL</li>
<li>pyproj</li>
<li>Fiona</li>
</ul>

<p>Then, install them with pip install</p>
<pre><code>pip install xxx-GDAL--.whl
pip install xxx-pyproj--.whl
pip install xxx-Fiona--.whl
</code></pre>
<p>Then, install GPRas</p>
<pre><code>pip install GPRas
</code></pre><h1></h1><h2>Usage</h2>
<p>import the module</p>
<pre><code>import GPRas as gpr
</code></pre><h3>data input and create the spatial graph concentration object</h3>
<p>Two ways of data input: csv file, nx.Graph object</p>

<p><strong>for csv file</strong>:
prepare the file paths and file setup info</p>
<pre><code>nodefile = &#x27;test_data&#x2F;TP_nodes.csv&#x27;
linkfile = &#x27;test_data&#x2F;TP_links.csv&#x27;
node_filesetup = {&#x27;node_id&#x27;:&#x27;nid&#x27;, &#x27;xcor&#x27;:&#x27;xcor&#x27;, &#x27;ycor&#x27;:&#x27;ycor&#x27;}
link_filesetup = {&#x27;ori&#x27;:&#x27;ori&#x27;, &#x27;des&#x27;:&#x27;des&#x27;, &#x27;weight&#x27;:&#x27;time&#x27;}
</code></pre>
<p>create the spatial_graph object</p>
<pre><code>sg = gpr.GPRas()
</code></pre>
<p>set the dataset from csv files
<code>
sg.dataset.from_csv(nodefile, linkfile, node_filesetup, link_filesetup)
</code></p>

<p><strong>for nx.Graph object</strong>
&ldquo;`
import networkx as nx
import pandas as pd ## just for the reading of file before creating nx.Graph
ndf = pd.read_csv(nodefile)
nii = ndf[node_filesetup[&lsquo;node_id&rsquo;]].tolist()
nxx = ndf[node_filesetup[&lsquo;xcor&rsquo;]].tolist()
nyy = ndf[node_filesetup[&lsquo;ycor&rsquo;]].tolist()
nodes_lis = [ (ii, dict(xxx=xx,yyy=yy)) for ii,xx,yy in zip(nii,nxx,nyy) ]
edf = pd.read_csv(linkfile)
eoo = edf[link_filesetup[&lsquo;ori&rsquo;]].tolist()
edd = edf[link_filesetup[&lsquo;des&rsquo;]].tolist()
edges_lis = [ (oo,dd) for oo,dd in zip(eoo,edd) ]</p>

<p>G = nx.Graph()
G.add_nodes_from(nodes_lis)
ag.add_edges_from(edges_lis)</p>
<h2>graph setup info</h2>
<p>node_setup = dict(xcor=&lsquo;xxx&rsquo;, ycor=&lsquo;yyy&rsquo;) ## x,y columns from the nodes attr.
link_setup = None</p>

<p>sg = sgc()
sg.dataset.from_nx(ag, node_setup, link_setup)
&rdquo;`</p>
<h3>prepare and calculate</h3>
<p>First, initialize the parameters</p>
<pre><code>sg.Initialize(iteration=5000, alpha=1., beta=1., gamma=1.)
</code></pre>
<p>Calculate all of them (6 PRs) using the above parameter
<code>
sg.CalculateAll()
</code></p>

<p>Calculate each of them using updated parameters
<code>
sg.PR()
sg.WPR(alpha=2, update=True)
sg.DDPR(beta=2, update=True)
sg.GPR(alpha=3, beta=2, update=True)
sg.eDDPR(gamma=0.6, update=True)
sg.eGPR(alpha=3, gamma=0.2, update=True)
</code>
these calculation will change the parameters for summary output, but not the default paramters (for calculation with no paramter setup, eg. alpha=None), which are set from the initialization.</p>
<h3>get the results in Pandas DataFrame format</h3>
<p>get summary df</p>
<pre><code>summary_df = sg.get_summary()
print summary_df.head()
</code></pre>
<p>get the nodes concentration results</p>
<pre><code>result_df = sg.get_results() ## default to all 6
print result_df.head()

part_result_df = sg.get_results(items=[&#x27;pr&#x27;, &#x27;wpr&#x27;]) ## export only PR and WPR
print part_result_df.head()
</code></pre><h3>export results</h3>
<p>the results can be export directly to csv format and shapfile format</p>

<p><strong>summary table</strong></p>
<pre><code>sg.output_summary(filename=&#x27;result&#x2F;temp_summary.csv&#x27;)
</code></pre>
<p><strong>to csv file</strong>
&ldquo;`
sg.to_csv(filename=&lsquo;result/temp_output_dd_g.csv&rsquo;, items=[&lsquo;ddpr&rsquo;,&lsquo;gpr&rsquo;])</p>
<h1>also same as to_csv() with items=None</h1>
<p>sg.All_to_csv(filename=&lsquo;result/temp_output.csv&rsquo;)
&rdquo;`</p>

<p><strong>to shp file</strong>
prepare a crs string, or it will be default to None
<code>
crs67 = &#39;+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=aust_SA +towgs84=-752,-358,-179,-0.0000011698,0.0000018398,0.0000009822,0.00002329 +units=m +no_defs&#39;
</code></p>

<p>export the files, which include a point shpfile for nodes and the concentration results, and a line shpfile for edge (no result inside, just for mapping)</p>

<p>output two of the results (PR and WPR) into one file</p>
<pre><code>sg.to_shps(filename_prefix=&#x27;result&#x2F;temp_shp_pr_wpr&#x27;, crs=crs67, items=[&#x27;pr&#x27;,&#x27;wpr&#x27;])
</code></pre>
<p>output all 6 PRs</p>
<pre><code>sg.All_to_shps(filename_prefix=&#x27;result&#x2F;temp_shp&#x27;, crs=crs67)
</code></pre><h3>to networkx graph object</h3>
<p>similar to the previous export</p>
<pre><code>ag,pos = sg.to_nx() ## default to all 6 PRs

ag,pos = sg.to_nx(items=[&quot;DDPR&quot;])
</code></pre>
<p>demo for drawing the networkx object</p>
<pre><code>import matplotlib.pyplot as plt

ss = []
for n,d in ag.nodes_iter(data=True):
    ss.append(d[&#x27;DDPR_score&#x27;]*5000.)

fig,ax = plt.subplots()
nx.draw_networkx_nodes(ag, pos=pos, node_size=ss)
nx.draw_networkx_edges(ag, pos=pos, alpha=0.3)
ax.set_aspect(&#x27;equal&#x27;)
plt.show()
</code></pre><h1></h1><h2>file structure</h2><pre><code>Geographical PageRank Algorithms
.
├── build
│   ├── bdist.linux-x86_64
│   └── lib
│       └── GPRas
│           ├── GPRa
│           │   ├── GPR_algorithms.py
│           │   ├── __init__.py
│           │   ├── input_func.py
│           │   ├── input_funcs
│           │   │   ├── DataImport_nx.py
│           │   │   ├── FileReading_csv.py
│           │   │   └── __init__.py
│           │   ├── output_func.py
│           │   └── output_funcs
│           │       ├── __init__.py
│           │       ├── to_csv.py
│           │       ├── to_nx.py
│           │       └── to_shps.py
│           ├── GPRas.py
│           └── __init__.py
├── dist
│   ├── GPRas-0.1.0-py2.7.egg
│   ├── GPRas-0.1.0-py2-none-any.whl
│   └── GPRas-0.1.0.tar.gz
├── GPRas
│   ├── example
│   │   ├── example_nx.py
│   │   ├── example.py
│   │   ├── result
│   │   │   └── demo results
│   │   └── test_data
│   │       ├── KH_links.csv
│   │       ├── KH_nodes.csv
│   │       ├── TC_links.csv
│   │       ├── TC_nodes.csv
│   │       ├── TP_links.csv
│   │       └── TP_nodes.csv
│   ├── GPRa
│   │   ├── GPR_algorithms.py
│   │   ├── __init__.py
│   │   ├── input_func.py
│   │   ├── input_funcs
│   │   │   ├── DataImport_nx.py
│   │   │   ├── FileReading_csv.py
│   │   │   └── __init__.py
│   │   ├── output_func.py
│   │   └── output_funcs
│   │       ├── __init__.py
│   │       ├── to_csv.py
│   │       ├── to_nx.py
│   │       └── to_shps.py
│   ├── GPRas.py
│   └── __init__.py
├── GPRas.egg-info
│   ├── dependency_links.txt
│   ├── PKG-INFO
│   ├── requires.txt
│   ├── SOURCES.txt
│   └── top_level.txt
├── LICENSE.txt
├── MANIFEST.in
├── README.md
└── setup.py

</code></pre>
         <div id="disqus_thread"></div>
     	<script type="text/javascript">
     		/* * * CONFIGURATION VARIABLES * * */
     		var disqus_shortname = 'chinminilab';

     		/* * * DON'T EDIT BELOW THIS LINE * * */
     		(function() {
     			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     		})();
     	</script>
     	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

     	<script type="text/javascript">
     		/* * * CONFIGURATION VARIABLES * * */
     		var disqus_shortname = 'chinminilab';

     		/* * * DON'T EDIT BELOW THIS LINE * * */
     		(function () {
     			var s = document.createElement('script'); s.async = true;
     			s.type = 'text/javascript';
     			s.src = '//' + disqus_shortname + '.disqus.com/count.js';
     			(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
     		}());
     	</script>
      </section>
      <footer>
        <p>This project is maintained by <a href="http://wcchin.github.io/about/"><span class="typcn typcn-user"></span>Benny Chin</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>

  </body>
</html>